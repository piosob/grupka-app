---
export const prerender = false;
import AuthLayout from '../layouts/AuthLayout.astro';
import { LoginForm } from '../components/react/LoginForm';
import Logo from '../components/astro/Logo.astro';
import { actions, isInputError } from 'astro:actions';
import type { ServerActionResult } from '../types';

// If user is already logged in, middleware will redirect to /dashboard
const actionResult = Astro.getActionResult(actions.auth.login);
if (actionResult && !actionResult.error) {
    return Astro.redirect(`/dashboard`);
}

const inputErrors = isInputError(actionResult?.error) ? actionResult.error.fields : undefined;
const generalError = !isInputError(actionResult?.error) ? actionResult?.error?.message : undefined;
---

<AuthLayout title="Logowanie">
    <div class="text-center mb-8">
        <div class="inline-block mb-4">
            <Logo />
        </div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Witaj z powrotem!</h1>
        <p class="text-gray-600 dark:text-gray-400 mt-2">
            Zaloguj się, aby zarządzać swoimi grupami
        </p>
    </div>

    <LoginForm action={actions.auth.login} error={generalError} inputErrors={inputErrors} />
</AuthLayout>
