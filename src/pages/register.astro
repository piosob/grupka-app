---
export const prerender = false;
import AuthLayout from '../layouts/AuthLayout.astro';
import { RegisterForm } from '../components/react/RegisterForm';
import Logo from '../components/astro/Logo.astro';
import { actions } from 'astro:actions';

// If user is already logged in, middleware will redirect to /dashboard
const actionResult = Astro.getActionResult(actions.auth.register);

const actionError = actionResult?.error;
const inputErrors = actionError && 'fields' in actionError ? (actionError as any).fields : undefined;
const generalError = actionError && !('fields' in actionError) ? actionError.message : undefined;

const successData = actionResult?.data;
const registerSuccess = Boolean(successData?.success);
const needsEmailConfirmation = Boolean(successData?.needsEmailConfirmation);


if (registerSuccess && !needsEmailConfirmation) {
    return Astro.redirect('/dashboard');
}
---

<AuthLayout title="Rejestracja">
    <div class="text-center mb-8">
        <div class="inline-block mb-4">
            <Logo />
        </div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Dołącz do Grupka!</h1>
        <p class="text-gray-600 dark:text-gray-400 mt-2">
            Utwórz konto i zacznij organizować urodziny w grupie
        </p>
    </div>

    <RegisterForm
        action={actions.auth.register}
        error={generalError}
        inputErrors={inputErrors}
        success={registerSuccess}
        needsEmailConfirmation={needsEmailConfirmation}
    />
</AuthLayout>
