---
export const prerender = false;
import AuthLayout from '../layouts/AuthLayout.astro';
import { ForgotPasswordForm } from '../components/react/ForgotPasswordForm';
import Logo from '../components/astro/Logo.astro';
import { actions } from 'astro:actions';
import type { ServerActionResult } from '../types';
import { requestPasswordReset as requestPasswordResetAction } from '../actions/auth';

// If user is already logged in, middleware will redirect to /dashboard
type ForgotPasswordActionResponse = {
    message?: string;
};

const forgotPasswordActionDefinition = requestPasswordResetAction as Parameters<
    typeof Astro.getActionResult
>[0];
const actionResult = Astro.getActionResult(
    forgotPasswordActionDefinition
) as ServerActionResult<ForgotPasswordActionResponse>;
const forgotError = actionResult?.error?.message;
const successMessage = actionResult?.data?.message;
---

<AuthLayout title="Reset hasła">
    <div class="text-center mb-8">
        <div class="inline-block mb-4">
            <Logo />
        </div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Zapomniałeś hasła?</h1>
        <p class="text-gray-600 dark:text-gray-400 mt-2">
            Nie martw się, pomożemy Ci odzyskać dostęp do konta
        </p>
    </div>

    <ForgotPasswordForm
        action={actions.auth.requestPasswordReset}
        error={forgotError}
        successMessage={successMessage}
    />
</AuthLayout>
